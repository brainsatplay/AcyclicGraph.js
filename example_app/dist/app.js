(()=>{var N=Object.defineProperty;var L=(o,e,t)=>e in o?N(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var w=(o,e)=>()=>(e||o((e={exports:{}}).exports,e),e.exports);var h=(o,e,t)=>(L(o,typeof e!="symbol"?e+"":e,t),t);var l=(o,e,t)=>new Promise((s,i)=>{var r=a=>{try{n(t.next(a))}catch(c){i(c)}},u=a=>{try{n(t.throw(a))}catch(c){i(c)}},n=a=>a.done?s(a.value):Promise.resolve(a.value).then(r,u);n((t=t.apply(o,e)).next())});var A=w((U,j)=>{j.exports=""});var E=w((Z,M)=>{M.exports=`<div>\r
    Check Console\r
    <button>Run</button>\r
</div>`});var T=w((te,P)=>{P.exports=`<div>\r
    <button>Run</button>\r
</div>`});var F=w((oe,$)=>{$.exports=`<div>Test worked!</div>\r
<button>Clickme</button>`});var d=class extends HTMLElement{constructor(){super();h(this,"template",e=>`<div> Custom Fragment Props: ${JSON.stringify(e)} </div>`);h(this,"props",{test:!0});h(this,"oncreate");h(this,"onresize");h(this,"ondelete");h(this,"onchanged");h(this,"fragment");h(this,"obsAttributes",["props","options","onchanged","onresize","ondelete","oncreate","template"]);h(this,"delete",()=>{this.fragment=void 0,this.remove(),this.ondelete&&this.ondelete(this.props)});h(this,"render",(e=this.props)=>{typeof this.template=="function"?this.templateString=this.template(e):this.templateString=this.template;let t=document.createElement("template");t.innerHTML=this.templateString;let s=t.content;this.fragment&&this.removeChild(this.fragment),this.fragment=s,this.appendChild(s),this.oncreate&&this.oncreate(e)});h(this,"state",{pushToState:{},data:{},triggers:{},setState(e){if(Object.assign(this.pushToState,e),Object.keys(this.triggers).length>0)for(let t of Object.getOwnPropertyNames(this.triggers))this.pushToState[t]&&(this.data[t]=this.pushToState[t],delete this.pushToState[t],this.triggers[t].forEach(s=>{s.onchanged(this.data[t])}));return this.pushToState},subscribeTrigger(e,t=s=>{}){if(e){this.triggers[e]||(this.triggers[e]=[]);let s=this.triggers[e].length;return this.triggers[e].push({idx:s,onchanged:t}),this.triggers[e].length-1}else return},unsubscribeTrigger(e,t){let s,i=this.triggers[e];if(i)if(!t)delete this.triggers[e];else return i.find(u=>{if(u.idx===t)return!0})&&i.splice(s,1),!0},subscribeTriggerOnce(e=void 0,t=s=>{}){let s,i=r=>{t(r),this.unsubscribeTrigger(e,s)};s=this.subscribeTrigger(e,i)}})}get observedAttributes(){return this.obsAttributes}get obsAttributes(){return this.obsAttributes}set obsAttributes(e){typeof e=="string"?this.obsAttributes.push(e):Array.isArray(e)&&(this.obsAttributes=e)}static get tag(){return this.name.toLowerCase()+"-"}static addElement(e=this.tag,t=this,s=void 0){f(t,e,s)}attributeChangedCallback(e,t,s){if(e==="onchanged"){let i=s;if(typeof i=="string"&&(i=b(i)),typeof i=="function"){this.onchanged=i,this.state.data.props=this.props,this.state.unsubscribeTrigger("props"),this.state.subscribeTrigger("props",this.onchanged);let r=new CustomEvent("changed",{detail:{props:this.props}});this.state.subscribeTrigger("props",()=>{this.dispatchEvent(r)})}}else if(e==="onresize"){let i=s;if(typeof i=="string"&&(i=b(i)),typeof i=="function"){try{window.removeEventListener("resize",this.onresize)}catch(r){}this.onresize=i,window.addEventListener("resize",this.onresize)}}else if(e==="ondelete"){let i=s;typeof i=="string"&&(i=b(i)),typeof i=="function"&&(this.ondelete=()=>{window.removeEventListener("resize",this.onresize),this.state.unsubscribeTrigger("props"),i()})}else if(e==="oncreate"){let i=s;typeof i=="string"&&(i=b(i)),typeof i=="function"&&(this.oncreate=i)}else if(e==="props"){let i=s;typeof i=="string"&&(i=JSON.parse(i)),Object.assign(this.props,i),this.state.setState({props:this.props})}else if(e==="template"){let i=s;this.template=options.template,typeof i=="function"?this.templateString=this.template(this.props):this.templateString=i,this.render(this.props);let r=new CustomEvent("created",{detail:{props:this.props}});this.dispatchEvent(r)}else{let i=s;if(e.includes("eval_"))e=e.split("_"),e.shift(),e=e.join(),i=b(s);else if(typeof s=="string")try{i=JSON.parse(s)}catch(r){i=s}this[e]=i,this.props[e]=i}}connectedCallback(){let e=this.getAttribute("props");typeof e=="string"&&(e=JSON.parse(e)),Object.assign(this.props,e),this.state.setState({props:this.props}),Array.from(this.attributes).forEach(u=>{let n=u.name;if(!this[n]){let a=u.value;if(n.includes("eval_"))n=n.split("_"),n.shift(),n=n.join(),a=b(u.value);else if(typeof u.value=="string")try{a=JSON.parse(u.value)}catch(c){a=u.value}Object.defineProperties(this,u,{value:a,writable:!0,get(){return this[n]},set(c){this.setAttribute(n,c)}}),this[n]=a,this.props[n]=a,this.obsAttributes.push(n)}});let t=new CustomEvent("resized",{detail:{props:this.props}}),s=new CustomEvent("changed",{detail:{props:this.props}}),i=new CustomEvent("deleted",{detail:{props:this.props}}),r=new CustomEvent("created",{detail:{props:this.props}});if(this.render(this.props),this.dispatchEvent(r),this.state.subscribeTrigger("props",()=>{this.dispatchEvent(s)}),typeof this.onresize=="function"&&window.addEventListener("resize",()=>{this.onresize(),this.dispatchEvent(t)}),typeof this.ondelete=="function"){let u=this.ondelete;this.ondelete=()=>{window.removeEventListener("resize",this.onresize),this.state.unsubscribeTrigger("props"),u(),this.dispatchEvent(i)}}typeof this.onchanged=="function"&&(this.state.data.props=this.props,this.state.subscribeTrigger("props",this.onchanged))}get props(){return this.props}set props(e={}){this.setAttribute("props",e)}get template(){return this.template}set template(e){this.setAttribute("template",e)}get render(){return this.render}get delete(){return this.delete}get state(){return this.state}get onchanged(){return this.onchanged}set onchanged(e){this.setAttribute("onchanged",e)}get onresize(){return this.props}set onresize(e){this.setAttribute("onresize",e)}get ondelete(){return this.props}set ondelete(e){this.setAttribute("ondelete",e)}get oncreate(){return this.oncreate}set oncreate(e){this.setAttribute("oncreated",e)}};function f(o,e,t=null){t?e?window.customElements.define(e,o,{extends:t}):window.customElements.define(o.name.toLowerCase()+"-",o,{extends:t}):e?window.customElements.define(e,o):window.customElements.define(o.name.toLowerCase()+"-",o)}function G(o=""){return o+Math.floor(Math.random()*1e15)}function b(method){let getFunctionBody=o=>o.replace(/^\W*(function[^{]+\{([\s\S]*)\}|[^=]+=>[^{]*\{([\s\S]*)\}|[^=]+=>(.+))/i,"$2$3$4"),getFunctionHead=o=>{let e=o.indexOf(")");return o.slice(0,o.indexOf("{",e)+1)},newFuncHead=getFunctionHead(method),newFuncBody=getFunctionBody(method),newFunc;try{if(newFuncHead.includes("function ")){let o=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(o,newFuncBody)}else if(newFuncHead.substring(0,6)===newFuncBody.substring(0,6)){let o=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(o,newFuncBody.substring(newFuncBody.indexOf("{")+1,newFuncBody.length-1))}else try{newFunc=eval(newFuncHead+newFuncBody+"}")}catch(err){newFunc=eval(method)}}catch(o){}return newFunc}var y=class{constructor(){this.nodes=new Map,this.nNodes=0,this.state={pushToState:{},data:{},triggers:{},setState(e){if(Object.assign(this.pushToState,e),Object.keys(this.triggers).length>0)for(let t of Object.getOwnPropertyNames(this.triggers))this.pushToState[t]&&(this.data[t]=this.pushToState[t],delete this.pushToState[t],this.triggers[t].forEach(s=>{s.onchange(this.data[t])}));return this.pushToState},subscribeTrigger(e,t=s=>{}){if(e){this.triggers[e]||(this.triggers[e]=[]);let s=this.triggers[e].length;return this.triggers[e].push({idx:s,onchange:t}),this.triggers[e].length-1}else return},unsubscribeTrigger(e,t){let s,i=this.triggers[e];if(i)if(!t)delete this.triggers[e];else return i.find(u=>{if(u.idx===t)return!0})&&i.splice(s,1),!0},subscribeTriggerOnce(e=void 0,t=s=>{}){let s,i=r=>{t(r),this.unsubscribeTrigger(e,s)};s=this.subscribeTrigger(e,i)}}}convertChildrenToNodes(e){e.convertChildrenToNodes(e)}addNode(e={}){return new m(e,void 0,this)}getNode(e){return this.nodes.get(e)}run(e,t,s){if(typeof e=="string"&&(e=this.nodes.get(e)),e)return e.runNode(e,t,s)}removeTree(e){if(typeof e=="string"&&(e=this.nodes.get(e)),e){let t=function(s){s.children&&(Array.isArray(s.children)?s.children.forEach(i=>{this.nodes.delete(i.tag),t(i)}):typeof s.children=="object"&&(this.nodes.delete(s.tag),t(s)))};this.nodes.delete(e.tag),t(e)}}removeNode(e){typeof e=="string"&&(e=this.nodes.get(e)),e&&this.nodes.delete(e.tag)}appendNode(e={},t){t.addChildren(e)}callParent(i,r){return l(this,arguments,function*(e,t,s=e){if(e==null?void 0:e.parent)return yield e.callParent(t,e.children,s)})}callChildren(r,u){return l(this,arguments,function*(e,t,s=e,i){if(e==null?void 0:e.children)return yield e.callChildren(t,s,i)})}subscribe(e,t=s=>{}){return this.state.subscribeTrigger(e,t)}unsubscribe(e,t){this.state.unsubscribeTrigger(e,t)}},m=class{constructor(e={},t,s){h(this,"parent");h(this,"children");h(this,"graph");!e.tag&&s?e.tag=`node${s.nNodes}`:e.tag||(e.tag=`node${Math.floor(Math.random()*1e10)}`),Object.assign(this,e),this.parent=t,this.graph=s,s&&(s.nNodes++,s.nodes.set(e.tag,this)),this.children&&this.convertChildrenToNodes(this)}operator(e,t=this,s){return e}runOp(i){return l(this,arguments,function*(e,t=this,s){let r=yield this.operator(e,t,s);return this.tag&&this.graph&&this.graph.state.setState({[this.tag]:r}),r})}runNode(e=this,t,s){if(typeof e=="string"){if(!this.graph)return;e=this.graph.nodes.get(e)}return new Promise(i=>l(this,null,function*(){if(e){let r=(n,a,c=0)=>new Promise(g=>l(this,null,function*(){c++;let p=yield n.runOp(a,n,s);if(typeof n.repeat=="number"){for(;c<n.repeat;){if(n.delay){setTimeout(()=>l(this,null,function*(){g(yield r(n,a,c))}),n.delay);break}else if(n.frame&&requestAnimationFrame){requestAnimationFrame(()=>l(this,null,function*(){g(yield r(n,a,c))}));break}else p=yield n.runOp(a,n,s);c++}if(c===n.repeat){g(p);return}}else if(typeof n.recursive=="number"){for(;c<n.recursive;){if(n.delay){setTimeout(()=>l(this,null,function*(){g(yield r(n,p,c))}),n.delay);break}else if(n.frame&&requestAnimationFrame){requestAnimationFrame(()=>l(this,null,function*(){g(yield r(n,p,c))}));break}else p=yield n.runOp(p,n,s);c++}if(c===n.recursive){g(p);return}}else{g(p);return}})),u=()=>l(this,null,function*(){let n=yield r(e,t);if(e.backward&&e.parent&&(yield this.runNode(e.parent,n,e)),e.children&&e.forward)if(Array.isArray(e.children))for(let a=0;a<e.children.length;a++)yield this.runNode(e.children[a],n,e);else yield this.runNode(e.children,n,e);if(e.animate&&!e.isAnimating){e.isAnimating=!0;let a=()=>l(this,null,function*(){e.isAnimating&&(yield e.runOp(t,e,s),requestAnimationFrame(()=>l(this,null,function*(){yield a()})))});requestAnimationFrame(a)}if(typeof e.loop=="number"&&!e.isLooping){e.isLooping=!0;let a=()=>l(this,null,function*(){e.looping&&(yield e.runOp(t,e,s),setTimeout(()=>l(this,null,function*(){yield a()}),e.loop))})}return n});e.delay?setTimeout(()=>l(this,null,function*(){i(yield u())}),e.delay):e.frame&&requestAnimationFrame?requestAnimationFrame(()=>l(this,null,function*(){i(yield u())})):i(yield u())}else i(void 0)}))}setOperator(e=function(s,i=this,r){return s}){this.operator=e}setParent(e){this.parent=e}setChildren(e){this.children=e}stopLooping(){node.isLooping=!1}stopAnimating(){node.isAnimating=!1}addChildren(e){this.children||(this.children=[]),!Array.isArray(this.children)&&this.children?this.children=[this.children]:Array.isArray(e)?this.children.push(...e):this.children.push(e)}convertChildrenToNodes(e=this){if(Array.isArray(e.children))for(let t=0;t<e.children.length;t++)e.children[t].constructor.name!==this.constructor.name&&(e.children[t]=new m(nn,e,this.graph),this.convertChildrenToNodes(e.children[t]));else if(typeof e.children=="object"){if(e.children.constructor.name===this.constructor.name)return;e.children=new m(e.children,e,this.graph),this.convertChildrenToNodes(e.children)}else typeof e.children=="string"&&(e.children=this.graph.getNode(e.children));return e.children}callParent(s){return l(this,arguments,function*(e,t=this){var i;if(typeof((i=this.parent)==null?void 0:i.operator)=="function")return yield this.parent.runOp(e,this.parent,t)})}callChildren(i){return l(this,arguments,function*(e,t=this,s){var u,n;let r;if(Array.isArray(this.children))if(s)r=yield(u=this.children[s])==null?void 0:u.runOp(e,this.children[s],t);else{r=[];for(let a=0;a<this.children.length;a++)r.push(yield(n=this.children[s])==null?void 0:n.runOp(e,this.children[s],t))}else this.children&&(r=yield this.children.runOp(e,this.children,t));return r})}setProps(e={}){Object.assign(this,e)}};var z=A(),q=class extends d{constructor(){super(...arguments);h(this,"props",{tag:void 0,input:void 0,operator:(e,t,s)=>(console.log(e),e),forward:!0,backward:!1,children:void 0,delay:!1,repeat:!1,recursive:!1,graph:void 0,node:void 0});h(this,"template",z);h(this,"oncreate",e=>{this.setupNode(e),e.input&&e.node.runNode(e.node,e.input,void 0)})}setupNode(e){let t=this.parentNode;if(t.tagName.toLowerCase()==="graph-node"&&(e.parent=t),!e.graph){for(;t.tagName.toLowerCase()!=="acyclic-graph";){if(t.constructor.name==="HTMLBodyElement"||t.constructor.name==="HTMLHeadElement"||t.constructor.name==="HTMLHtmlElement"||t.constructor.name==="HTMLDocument"){console.error("No AcyclicGraph Found");break}t=t.parentNode}t.tagName.toLowerCase()==="acyclic-graph"&&(e.graph=t.props.graph)}this.id&&!e.tag&&(e.tag=this.id),e.graph&&!e.node&&(e.node=e.graph.nodes.get(e.tag)),e.node||(e.node=new m(e,t.node,e.graph)),e.tag=e.node.tag,this.id||(this.id=e.tag),e.parent&&setTimeout(()=>{var s;(s=e.parent.props.node)==null||s.addChildren(e.node)},2)}};f(q,"graph-node");var H=E(),O=class extends d{constructor(){super(...arguments);h(this,"props",{graph:new y,nodes:[]});h(this,"template",H);h(this,"graphnode");h(this,"oncreate",e=>{setTimeout(()=>{let t=Array.from(this.children),s=[];(t==null?void 0:t.length)>0&&t.forEach(i=>{i.props&&e.nodes.push(i.props.node),i.props&&i.parentNode.tagName===this.tagName&&s.push(i)}),this.querySelector("button").onclick=()=>{s.forEach(i=>{i.props.node.runNode(i.props.node,"Test")})}},1)})}};f(O,"acyclic-graph");var B=T(),v=class extends d{constructor(){super(...arguments);h(this,"props",{operation:e=>e});h(this,"template",B);h(this,"oncreate",e=>{})}};f(v,"snode-");var S=class{constructor(){h(this,"addSequence",this.add);h(this,"runSequence",this.run);h(this,"append",this.appendSequence);h(this,"remove",this.removeSequence);h(this,"get",this.getSequence);h(this,"subscribeToOperation",this.subscribe);h(this,"unsubscribeFromOperation",this.unsubscribe);this.sequences=new Map,this.state={pushToState:{},data:{},triggers:{},setState(e){if(Object.assign(this.pushToState,e),Object.keys(this.triggers).length>0)for(let t of Object.getOwnPropertyNames(this.triggers))this.pushToState[t]&&(this.data[t]=this.pushToState[t],delete this.pushToState[t],this.triggers[t].forEach(s=>{s.onchange(this.data[t])}));return this.pushToState},subscribeTrigger(e,t=s=>{}){if(e){this.triggers[e]||(this.triggers[e]=[]);let s=this.triggers[e].length;return this.triggers[e].push({idx:s,onchange:t}),this.triggers[e].length-1}else return},unsubscribeTrigger(e,t){let s,i=this.triggers[e];if(i)if(!t)delete this.triggers[e];else return i.find(u=>{if(u.idx===t)return!0})&&i.splice(s,1),!0},subscribeTriggerOnce(e=void 0,t=s=>{}){let s,i=r=>{t(r),this.unsubscribeTrigger(e,s)};s=this.subscribeTrigger(e,i)}}}add(e,t=[]){this.sequences.set(e,t)}run(e,t,s=1){return l(this,null,function*(){let i=this.sequences.get(e);if(i)if(s>1){let r=2,u=i.next;for(;r<s;)u=u.next;yield this.runSequenceLayer(u,t)}else yield this.runSequenceLayer(i,t)})}appendSequence(e,t,s={},i){var u,n;let r=this.getSequence(e,t);r&&(Array.isArray(r)||(r=[r]),i?(((u=r[i])==null?void 0:u.next)||(r.next=[]),(n=r[i])==null||n.next.push(s)):r.push(s))}removeSequence(e,t,s){let i;t?i=this.getSequence(e,t-1):i=this.getSequence(e),i&&(s&&i[s]?i.splice(s,1):t&&i.next?(i.tag&&this.unsubscribeFromOperation(i.tag),delete i.next):i&&this.sequences.delete(e))}getSequence(e,t=1){let s=this.sequences.get(e);if(s){if(t>1){let i=2,r=s.next;for(;i<t&&r.next;)r=r.next,i++;return r}return s}}runSequenceLayer(e,t){return l(this,null,function*(){let s=(i,r,u=1)=>l(this,null,function*(){if(!i.operation)if(i.op)i.operation=i.op;else if(i.o)i.operation=i.o;else if(i.f)i.operation=i.f;else if(i.fn)i.operaiion=i.fn;else if(i.callback)i.operation=i.callback;else return r;let n=yield i.operation(r);if(i.tag&&this.state.setState({[i.tag]:n}),typeof i.repeat=="number"){let a=u;for(;a<i.repeat;){if(i.delay){setTimeout(()=>l(this,null,function*(){i.frame?requestAnimationFrame(()=>l(this,null,function*(){a++,yield s(i,r,a)})):(a++,yield s(i,r,a))}),i.delay);break}else n=yield i.operation(r);a++}a===i.repeat&&i.next&&(yield this.runSequenceLayer(i.next,n))}else if(typeof i.recursive=="number"){let a=u;for(;a<i.recursive;){if(i.delay){setTimeout(()=>l(this,null,function*(){i.frame?requestAnimationFrame(()=>l(this,null,function*(){a++,yield s(i,n,a)})):(a++,yield s(i,n,a))}),i.delay);break}else n=yield i.operation(r);a++}a===i.recursive&&i.next&&(yield this.runSequenceLayer(i.next,n))}else i.next&&(yield this.runSequenceLayer(i.next,n))});if(typeof e=="function")yield e(t);else if(typeof e=="string")this.runSequence(e,t);else if(Array.isArray(e))for(let i=0;i<e.length;i++){let r=e[i];typeof r=="function"?t=yield r(t):r.delay?r.frame&&typeof requestAnimationFrame=="function"?setTimeout(()=>l(this,null,function*(){requestAnimationFrame(()=>l(this,null,function*(){s(r,t)}))}),r.delay):setTimeout(()=>l(this,null,function*(){s(r,t)}),r.delay):r.frame?requestAnimationFrame(()=>l(this,null,function*(){s(r,t)})):s(r,t)}else typeof e=="object"&&s(e,t)})}subscribe(e,t=s=>{}){if(e)return this.state.subscribeTrigger(e,t)}unsubscribe(e,t){e&&this.state.unsubscribeTrigger(e,t)}};var D=T(),x=class extends d{constructor(){super(...arguments);h(this,"props",{sequencer:new S,sequences:[]});h(this,"template",D);h(this,"graphnode");h(this,"oncreate",e=>{let t=this.querySelectorAll("seq-node");(t==null?void 0:t.length)>0&&t.forEach(i=>{e.nodes.push(i.props.node)});let s=this.querySelectorAll("sequencer- > snode");this.querySelector("button").onclick=()=>{s.forEach(i=>{e.graph.run(i.props.node)})}})}};f(x,"sequencer-");var J=F(),C=class extends d{constructor(){super(...arguments);h(this,"props",{});h(this,"template",J);h(this,"oncreate",e=>{let t=this.querySelector("button"),s=this.querySelector("div");t&&(t.onclick=i=>{s.innerHTML="Clicked!"})})}};f(C,"custom-");})();
//# sourceMappingURL=app.js.map
