(()=>{var C=Object.defineProperty;var j=(o,e,i)=>e in o?C(o,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[e]=i;var w=(o,e)=>()=>(e||o((e={exports:{}}).exports,e),e.exports);var a=(o,e,i)=>(j(o,typeof e!="symbol"?e+"":e,i),i);var l=(o,e,i)=>new Promise((s,t)=>{var r=h=>{try{n(i.next(h))}catch(c){t(c)}},u=h=>{try{n(i.throw(h))}catch(c){t(c)}},n=h=>h.done?s(h.value):Promise.resolve(h.value).then(r,u);n((i=i.apply(o,e)).next())});var q=w((U,L)=>{L.exports="<div></div>"});var v=w((Z,M)=>{M.exports=`<div>\r
    <button>Run</button>\r
</div>`});var T=w((te,P)=>{P.exports=`<div>\r
    <button>Run</button>\r
</div>`});var F=w((oe,$)=>{$.exports=`<div>Test worked!</div>\r
<button>Clickme</button>`});var d=class extends HTMLElement{constructor(){super();a(this,"template",e=>`<div> Custom Fragment Props: ${JSON.stringify(e)} </div>`);a(this,"props",{test:!0});a(this,"oncreate");a(this,"onresize");a(this,"ondelete");a(this,"onchanged");a(this,"fragment");a(this,"obsAttributes",["props","options","onchanged","onresize","ondelete","oncreate","template"]);a(this,"delete",()=>{this.fragment=void 0,this.remove(),this.ondelete&&this.ondelete(this.props)});a(this,"render",(e=this.props)=>{typeof this.template=="function"?this.templateString=this.template(e):this.templateString=this.template;let i=document.createElement("template");i.innerHTML=this.templateString;let s=i.content;this.fragment&&this.removeChild(this.fragment),this.fragment=s,this.appendChild(s),this.oncreate&&this.oncreate(e)});a(this,"state",{pushToState:{},data:{},triggers:{},setState(e){if(Object.assign(this.pushToState,e),Object.keys(this.triggers).length>0)for(let i of Object.getOwnPropertyNames(this.triggers))this.pushToState[i]&&(this.data[i]=this.pushToState[i],delete this.pushToState[i],this.triggers[i].forEach(s=>{s.onchanged(this.data[i])}));return this.pushToState},subscribeTrigger(e,i=s=>{}){if(e){this.triggers[e]||(this.triggers[e]=[]);let s=this.triggers[e].length;return this.triggers[e].push({idx:s,onchanged:i}),this.triggers[e].length-1}else return},unsubscribeTrigger(e,i){let s,t=this.triggers[e];if(t)if(!i)delete this.triggers[e];else return t.find(u=>{if(u.idx===i)return!0})&&t.splice(s,1),!0},subscribeTriggerOnce(e=void 0,i=s=>{}){let s,t=r=>{i(r),this.unsubscribeTrigger(e,s)};s=this.subscribeTrigger(e,t)}})}get observedAttributes(){return this.obsAttributes}get obsAttributes(){return this.obsAttributes}set obsAttributes(e){typeof e=="string"?this.obsAttributes.push(e):Array.isArray(e)&&(this.obsAttributes=e)}static get tag(){return this.name.toLowerCase()+"-"}static addElement(e=this.tag,i=this,s=void 0){p(i,e,s)}attributeChangedCallback(e,i,s){if(e==="onchanged"){let t=s;if(typeof t=="string"&&(t=b(t)),typeof t=="function"){this.onchanged=t,this.state.data.props=this.props,this.state.unsubscribeTrigger("props"),this.state.subscribeTrigger("props",this.onchanged);let r=new CustomEvent("changed",{detail:{props:this.props}});this.state.subscribeTrigger("props",()=>{this.dispatchEvent(r)})}}else if(e==="onresize"){let t=s;if(typeof t=="string"&&(t=b(t)),typeof t=="function"){try{window.removeEventListener("resize",this.onresize)}catch(r){}this.onresize=t,window.addEventListener("resize",this.onresize)}}else if(e==="ondelete"){let t=s;typeof t=="string"&&(t=b(t)),typeof t=="function"&&(this.ondelete=()=>{window.removeEventListener("resize",this.onresize),this.state.unsubscribeTrigger("props"),t()})}else if(e==="oncreate"){let t=s;typeof t=="string"&&(t=b(t)),typeof t=="function"&&(this.oncreate=t)}else if(e==="props"){let t=s;typeof t=="string"&&(t=JSON.parse(t)),Object.assign(this.props,t),this.state.setState({props:this.props})}else if(e==="template"){let t=s;this.template=options.template,typeof t=="function"?this.templateString=this.template(this.props):this.templateString=t,this.render(this.props);let r=new CustomEvent("created",{detail:{props:this.props}});this.dispatchEvent(r)}else{let t=s;if(e.includes("eval_"))e=e.split("_"),e.shift(),e=e.join(),t=b(s);else if(typeof s=="string")try{t=JSON.parse(s)}catch(r){t=s}this[e]=t,this.props[e]=t}}connectedCallback(){let e=this.getAttribute("props");typeof e=="string"&&(e=JSON.parse(e)),Object.assign(this.props,e),this.state.setState({props:this.props}),Array.from(this.attributes).forEach(u=>{let n=u.name;if(!this[n]){let h=u.value;if(n.includes("eval_"))n=n.split("_"),n.shift(),n=n.join(),h=b(u.value);else if(typeof u.value=="string")try{h=JSON.parse(u.value)}catch(c){h=u.value}Object.defineProperties(this,u,{value:h,writable:!0,get(){return this[n]},set(c){this.setAttribute(n,c)}}),this[n]=h,this.props[n]=h,this.obsAttributes.push(n)}});let i=new CustomEvent("resized",{detail:{props:this.props}}),s=new CustomEvent("changed",{detail:{props:this.props}}),t=new CustomEvent("deleted",{detail:{props:this.props}}),r=new CustomEvent("created",{detail:{props:this.props}});if(this.render(this.props),this.dispatchEvent(r),this.state.subscribeTrigger("props",()=>{this.dispatchEvent(s)}),typeof this.onresize=="function"&&window.addEventListener("resize",()=>{this.onresize(),this.dispatchEvent(i)}),typeof this.ondelete=="function"){let u=this.ondelete;this.ondelete=()=>{window.removeEventListener("resize",this.onresize),this.state.unsubscribeTrigger("props"),u(),this.dispatchEvent(t)}}typeof this.onchanged=="function"&&(this.state.data.props=this.props,this.state.subscribeTrigger("props",this.onchanged))}get props(){return this.props}set props(e={}){this.setAttribute("props",e)}get template(){return this.template}set template(e){this.setAttribute("template",e)}get render(){return this.render}get delete(){return this.delete}get state(){return this.state}get onchanged(){return this.onchanged}set onchanged(e){this.setAttribute("onchanged",e)}get onresize(){return this.props}set onresize(e){this.setAttribute("onresize",e)}get ondelete(){return this.props}set ondelete(e){this.setAttribute("ondelete",e)}get oncreate(){return this.oncreate}set oncreate(e){this.setAttribute("oncreated",e)}};function p(o,e,i=null){i?e?window.customElements.define(e,o,{extends:i}):window.customElements.define(o.name.toLowerCase()+"-",o,{extends:i}):e?window.customElements.define(e,o):window.customElements.define(o.name.toLowerCase()+"-",o)}function G(o=""){return o+Math.floor(Math.random()*1e15)}function b(method){let getFunctionBody=o=>o.replace(/^\W*(function[^{]+\{([\s\S]*)\}|[^=]+=>[^{]*\{([\s\S]*)\}|[^=]+=>(.+))/i,"$2$3$4"),getFunctionHead=o=>{let e=o.indexOf(")");return o.slice(0,o.indexOf("{",e)+1)},newFuncHead=getFunctionHead(method),newFuncBody=getFunctionBody(method),newFunc;try{if(newFuncHead.includes("function ")){let o=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(o,newFuncBody)}else if(newFuncHead.substring(0,6)===newFuncBody.substring(0,6)){let o=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(o,newFuncBody.substring(newFuncBody.indexOf("{")+1,newFuncBody.length-1))}else try{newFunc=eval(newFuncHead+newFuncBody+"}")}catch(err){newFunc=eval(method)}}catch(o){}return newFunc}var y=class{constructor(){this.nodes=new Map,this.nNodes=0,this.state={pushToState:{},data:{},triggers:{},setState(e){if(Object.assign(this.pushToState,e),Object.keys(this.triggers).length>0)for(let i of Object.getOwnPropertyNames(this.triggers))this.pushToState[i]&&(this.data[i]=this.pushToState[i],delete this.pushToState[i],this.triggers[i].forEach(s=>{s.onchange(this.data[i])}));return this.pushToState},subscribeTrigger(e,i=s=>{}){if(e){this.triggers[e]||(this.triggers[e]=[]);let s=this.triggers[e].length;return this.triggers[e].push({idx:s,onchange:i}),this.triggers[e].length-1}else return},unsubscribeTrigger(e,i){let s,t=this.triggers[e];if(t)if(!i)delete this.triggers[e];else return t.find(u=>{if(u.idx===i)return!0})&&t.splice(s,1),!0},subscribeTriggerOnce(e=void 0,i=s=>{}){let s,t=r=>{i(r),this.unsubscribeTrigger(e,s)};s=this.subscribeTrigger(e,t)}}}convertChildrenToNodes(e){e.convertChildrenToNodes(e)}addNode(e={}){return new m(e,void 0,this)}getNode(e){return this.nodes.get(e)}run(e,i,s){if(typeof e=="string"&&(e=this.nodes.get(e)),e)return e.runNode(e,i,s)}removeTree(e){if(typeof e=="string"&&(e=this.nodes.get(e)),e){let i=function(s){s.children&&(Array.isArray(s.children)?s.children.forEach(t=>{this.nodes.delete(t.tag),i(t)}):typeof s.children=="object"&&(this.nodes.delete(s.tag),i(s)))};this.nodes.delete(e.tag),i(e)}}removeNode(e){typeof e=="string"&&(e=this.nodes.get(e)),e&&this.nodes.delete(e.tag)}appendNode(e={},i){i.addChildren(e)}callParent(t,r){return l(this,arguments,function*(e,i,s=e){if(e==null?void 0:e.parent)return yield e.callParent(i,e.children,s)})}callChildren(r,u){return l(this,arguments,function*(e,i,s=e,t){if(e==null?void 0:e.children)return yield e.callChildren(i,s,t)})}subscribe(e,i=s=>{}){return this.state.subscribeTrigger(e,i)}unsubscribe(e,i){this.state.unsubscribeTrigger(e,i)}},m=class{constructor(e={},i,s){a(this,"parent");a(this,"children");a(this,"graph");!e.tag&&s?e.tag=`node${s.nNodes}`:e.tag||(e.tag=`node${Math.floor(Math.random()*1e10)}`),Object.assign(this,e),this.parent=i,this.graph=s,s&&(s.nNodes++,s.nodes.set(e.tag,this)),this.children&&this.convertChildrenToNodes(this)}operator(e,i=this,s){return e}runOp(t){return l(this,arguments,function*(e,i=this,s){let r=yield this.operator(e,i,s);return this.tag&&this.graph&&this.graph.state.setState({[this.tag]:r}),r})}runNode(e=this,i,s){if(typeof e=="string"){if(!this.graph)return;e=this.graph.nodes.get(e)}return new Promise(t=>l(this,null,function*(){if(e){let r=(n,h,c=0)=>new Promise(g=>l(this,null,function*(){c++;let f=yield n.runOp(h,n,s);if(typeof n.repeat=="number"){for(;c<n.repeat;){if(n.delay){setTimeout(()=>l(this,null,function*(){g(yield r(n,h,c))}),n.delay);break}else if(n.frame&&requestAnimationFrame){requestAnimationFrame(()=>l(this,null,function*(){g(yield r(n,h,c))}));break}else f=yield n.runOp(h,n,s);c++}if(c===n.repeat){g(f);return}}else if(typeof n.recursive=="number"){for(;c<n.recursive;){if(n.delay){setTimeout(()=>l(this,null,function*(){g(yield r(n,f,c))}),n.delay);break}else if(n.frame&&requestAnimationFrame){requestAnimationFrame(()=>l(this,null,function*(){g(yield r(n,f,c))}));break}else f=yield n.runOp(f,n,s);c++}if(c===n.recursive){g(f);return}}else{g(f);return}})),u=()=>l(this,null,function*(){let n=yield r(e,i);if(e.backward&&e.parent&&(yield this.runNode(e.parent,n,e)),e.children&&e.forward)if(Array.isArray(e.children))for(let h=0;h<e.children.length;h++)yield this.runNode(e.children[h],n,e);else yield this.runNode(e.children,n,e);return n});e.delay?setTimeout(()=>l(this,null,function*(){t(yield u())}),e.delay):e.frame&&requestAnimationFrame?requestAnimationFrame(()=>l(this,null,function*(){t(yield u())})):t(yield u())}else t(void 0)}))}setOperator(e=function(s,t=this,r){return s}){this.operator=e}setParent(e){this.parent=e}addChildren(e){Array.isArray(this.children)||(this.children=[this.children]),Array.isArray(e)?this.children.push(...e):this.children.push(e)}convertChildrenToNodes(e=this){if(Array.isArray(e.children))for(let i=0;i<e.children.length;i++)e.children[i].constructor.name!==this.constructor.name&&(e.children[i]=new m(nn,e,this.graph),this.convertChildrenToNodes(e.children[i]));else if(typeof e.children=="object"){if(e.children.constructor.name===this.constructor.name)return;e.children=new m(e.children,e,this.graph),this.convertChildrenToNodes(e.children)}else typeof e.children=="string"&&(e.children=this.graph.getNode(e.children));return e.children}callParent(s){return l(this,arguments,function*(e,i=this){var t;if(typeof((t=this.parent)==null?void 0:t.operator)=="function")return yield this.parent.runOp(e,this.parent,i)})}callChildren(t){return l(this,arguments,function*(e,i=this,s){var u,n;let r;if(Array.isArray(this.children))if(s)r=yield(u=this.children[s])==null?void 0:u.runOp(e,this.children[s],i);else{r=[];for(let h=0;h<this.children.length;h++)r.push(yield(n=this.children[s])==null?void 0:n.runOp(e,this.children[s],i))}else this.children&&(r=yield this.children.runOp(e,this.children,i));return r})}setProps(e={}){Object.assign(this,e)}};var z=q(),A=class extends d{constructor(){super(...arguments);a(this,"props",{tag:void 0,input:void 0,operator:(e,i,s)=>(console.log(e),e),forward:!0,backward:!1,children:void 0,delay:!1,repeat:!1,recursive:!1,graph:void 0,node:void 0});a(this,"template",z);a(this,"oncreate",e=>{this.setupNode(e),e.input&&e.node.runNode(e.node,e.input,void 0)})}setupNode(e){let i=this.parentNode;if(i.tagName.toLowerCase()==="graph-node"&&(e.parent=i),!e.graph){for(;i.tagName.toLowerCase()!=="acyclic-graph";){if(i.constructor.name==="HTMLBodyElement"||i.constructor.name==="HTMLHeadElement"||i.constructor.name==="HTMLHtmlElement"||i.constructor.name==="HTMLDocument"){console.error("No AcyclicGraph Found");break}i=i.parentNode}i.tagName.toLowerCase()==="acyclic-graph"&&(e.graph=i.props.graph)}this.id&&!e.tag&&(e.tag=this.id),e.node=new m(e,i.node,e.graph),e.parent&&setTimeout(()=>{var s;(s=e.parent.props.node)==null||s.addChildren(e.node)},1),e.tag=e.node.tag,this.id||(this.id=e.tag)}};p(A,"graph-node");var H=v(),E=class extends d{constructor(){super(...arguments);a(this,"props",{graph:new y,nodes:[]});a(this,"template",H);a(this,"graphnode");a(this,"oncreate",e=>{setTimeout(()=>{let i=Array.from(this.children),s=[];(i==null?void 0:i.length)>0&&i.forEach(t=>{console.log(t),t.props&&e.nodes.push(t.props.node),t.props&&t.parentNode.tagName===this.tagName&&s.push(t)}),this.querySelector("button").onclick=()=>{s.forEach(t=>{t.props.node.runNode(t.props.node,"Test")})}},1)})}};p(E,"acyclic-graph");var B=T(),O=class extends d{constructor(){super(...arguments);a(this,"props",{operation:e=>e});a(this,"template",B);a(this,"oncreate",e=>{})}};p(O,"snode-");var S=class{constructor(){a(this,"addSequence",this.add);a(this,"runSequence",this.run);a(this,"append",this.appendSequence);a(this,"remove",this.removeSequence);a(this,"get",this.getSequence);a(this,"subscribeToOperation",this.subscribe);a(this,"unsubscribeFromOperation",this.unsubscribe);this.sequences=new Map,this.state={pushToState:{},data:{},triggers:{},setState(e){if(Object.assign(this.pushToState,e),Object.keys(this.triggers).length>0)for(let i of Object.getOwnPropertyNames(this.triggers))this.pushToState[i]&&(this.data[i]=this.pushToState[i],delete this.pushToState[i],this.triggers[i].forEach(s=>{s.onchange(this.data[i])}));return this.pushToState},subscribeTrigger(e,i=s=>{}){if(e){this.triggers[e]||(this.triggers[e]=[]);let s=this.triggers[e].length;return this.triggers[e].push({idx:s,onchange:i}),this.triggers[e].length-1}else return},unsubscribeTrigger(e,i){let s,t=this.triggers[e];if(t)if(!i)delete this.triggers[e];else return t.find(u=>{if(u.idx===i)return!0})&&t.splice(s,1),!0},subscribeTriggerOnce(e=void 0,i=s=>{}){let s,t=r=>{i(r),this.unsubscribeTrigger(e,s)};s=this.subscribeTrigger(e,t)}}}add(e,i=[]){this.sequences.set(e,i)}run(e,i,s=1){return l(this,null,function*(){let t=this.sequences.get(e);if(t)if(s>1){let r=2,u=t.next;for(;r<s;)u=u.next;yield this.runSequenceLayer(u,i)}else yield this.runSequenceLayer(t,i)})}appendSequence(e,i,s={},t){var u,n;let r=this.getSequence(e,i);r&&(Array.isArray(r)||(r=[r]),t?(((u=r[t])==null?void 0:u.next)||(r.next=[]),(n=r[t])==null||n.next.push(s)):r.push(s))}removeSequence(e,i,s){let t;i?t=this.getSequence(e,i-1):t=this.getSequence(e),t&&(s&&t[s]?t.splice(s,1):i&&t.next?(t.tag&&this.unsubscribeFromOperation(t.tag),delete t.next):t&&this.sequences.delete(e))}getSequence(e,i=1){let s=this.sequences.get(e);if(s){if(i>1){let t=2,r=s.next;for(;t<i&&r.next;)r=r.next,t++;return r}return s}}runSequenceLayer(e,i){return l(this,null,function*(){let s=(t,r,u=1)=>l(this,null,function*(){if(!t.operation)if(t.op)t.operation=t.op;else if(t.o)t.operation=t.o;else if(t.f)t.operation=t.f;else if(t.fn)t.operaiion=t.fn;else if(t.callback)t.operation=t.callback;else return r;let n=yield t.operation(r);if(t.tag&&this.state.setState({[t.tag]:n}),typeof t.repeat=="number"){let h=u;for(;h<t.repeat;){if(t.delay){setTimeout(()=>l(this,null,function*(){t.frame?requestAnimationFrame(()=>l(this,null,function*(){h++,yield s(t,r,h)})):(h++,yield s(t,r,h))}),t.delay);break}else n=yield t.operation(r);h++}h===t.repeat&&t.next&&(yield this.runSequenceLayer(t.next,n))}else if(typeof t.recursive=="number"){let h=u;for(;h<t.recursive;){if(t.delay){setTimeout(()=>l(this,null,function*(){t.frame?requestAnimationFrame(()=>l(this,null,function*(){h++,yield s(t,n,h)})):(h++,yield s(t,n,h))}),t.delay);break}else n=yield t.operation(r);h++}h===t.recursive&&t.next&&(yield this.runSequenceLayer(t.next,n))}else t.next&&(yield this.runSequenceLayer(t.next,n))});if(typeof e=="function")yield e(i);else if(typeof e=="string")this.runSequence(e,i);else if(Array.isArray(e))for(let t=0;t<e.length;t++){let r=e[t];typeof r=="function"?i=yield r(i):r.delay?r.frame&&typeof requestAnimationFrame=="function"?setTimeout(()=>l(this,null,function*(){requestAnimationFrame(()=>l(this,null,function*(){s(r,i)}))}),r.delay):setTimeout(()=>l(this,null,function*(){s(r,i)}),r.delay):r.frame?requestAnimationFrame(()=>l(this,null,function*(){s(r,i)})):s(r,i)}else typeof e=="object"&&s(e,i)})}subscribe(e,i=s=>{}){if(e)return this.state.subscribeTrigger(e,i)}unsubscribe(e,i){e&&this.state.unsubscribeTrigger(e,i)}};var D=T(),x=class extends d{constructor(){super(...arguments);a(this,"props",{sequencer:new S,sequences:[]});a(this,"template",D);a(this,"graphnode");a(this,"oncreate",e=>{let i=this.querySelectorAll("seq-node");(i==null?void 0:i.length)>0&&i.forEach(t=>{e.nodes.push(t.props.node)});let s=this.querySelectorAll("sequencer- > snode");this.querySelector("button").onclick=()=>{s.forEach(t=>{e.graph.run(t.props.node)})}})}};p(x,"sequencer-");var J=F(),N=class extends d{constructor(){super(...arguments);a(this,"props",{});a(this,"template",J);a(this,"oncreate",e=>{let i=this.querySelector("button"),s=this.querySelector("div");i&&(i.onclick=t=>{s.innerHTML="Clicked!"})})}};p(N,"custom-");})();
//# sourceMappingURL=app.js.map
