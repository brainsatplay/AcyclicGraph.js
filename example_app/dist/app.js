(()=>{var N=Object.defineProperty;var C=(n,e,t)=>e in n?N(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var w=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var a=(n,e,t)=>(C(n,typeof e!="symbol"?e+"":e,t),t);var c=(n,e,t)=>new Promise((i,s)=>{var h=o=>{try{r(t.next(o))}catch(l){s(l)}},u=o=>{try{r(t.throw(o))}catch(l){s(l)}},r=o=>o.done?i(o.value):Promise.resolve(o.value).then(h,u);r((t=t.apply(n,e)).next())});var S=w((K,j)=>{j.exports="<div></div>"});var A=w((X,L)=>{L.exports=`<div>\r
    <button>Run</button>\r
</div>`});var T=w((k,H)=>{H.exports=`<div>\r
    <button>Run</button>\r
</div>`});var O=w((oe,B)=>{B.exports=`<div>Test worked!</div>\r
<button>Clickme</button>`});var p=class extends HTMLElement{constructor(){super();a(this,"template",e=>`<div> Custom Fragment Props: ${JSON.stringify(e)} </div>`);a(this,"props",{test:!0});a(this,"oncreate");a(this,"onresize");a(this,"ondelete");a(this,"onchanged");a(this,"fragment");a(this,"obsAttributes",["props","options","onchanged","onresize","ondelete","oncreate","template"]);a(this,"delete",()=>{this.fragment=void 0,this.remove(),this.ondelete&&this.ondelete(this.props)});a(this,"render",(e=this.props)=>{typeof this.template=="function"?this.templateString=this.template(e):this.templateString=this.template;let t=document.createElement("template");t.innerHTML=this.templateString;let i=t.content;this.fragment&&this.removeChild(this.fragment),this.fragment=i,this.appendChild(i),this.oncreate&&this.oncreate(e)});a(this,"state",{pushToState:{},data:{},triggers:{},setState(e){if(Object.assign(this.pushToState,e),Object.keys(this.triggers).length>0)for(let t of Object.getOwnPropertyNames(this.triggers))this.pushToState[t]&&(this.data[t]=this.pushToState[t],delete this.pushToState[t],this.triggers[t].forEach(i=>{i.onchanged(this.data[t])}));return this.pushToState},subscribeTrigger(e,t=i=>{}){if(e){this.triggers[e]||(this.triggers[e]=[]);let i=this.triggers[e].length;return this.triggers[e].push({idx:i,onchanged:t}),this.triggers[e].length-1}else return},unsubscribeTrigger(e,t){let i,s=this.triggers[e];if(s)if(!t)delete this.triggers[e];else return s.find(u=>{if(u.idx===t)return!0})&&s.splice(i,1),!0},subscribeTriggerOnce(e=void 0,t=i=>{}){let i,s=h=>{t(h),this.unsubscribeTrigger(e,i)};i=this.subscribeTrigger(e,s)}})}get observedAttributes(){return this.obsAttributes}get obsAttributes(){return this.obsAttributes}set obsAttributes(e){typeof e=="string"?this.obsAttributes.push(e):Array.isArray(e)&&(this.obsAttributes=e)}static get tag(){return this.name.toLowerCase()+"-"}static addElement(e=this.tag,t=this,i=void 0){d(t,e,i)}attributeChangedCallback(e,t,i){if(e==="onchanged"){let s=i;if(typeof s=="string"&&(s=b(s)),typeof s=="function"){this.onchanged=s,this.state.data.props=this.props,this.state.unsubscribeTrigger("props"),this.state.subscribeTrigger("props",this.onchanged);let h=new CustomEvent("changed",{detail:{props:this.props}});this.state.subscribeTrigger("props",()=>{this.dispatchEvent(h)})}}else if(e==="onresize"){let s=i;if(typeof s=="string"&&(s=b(s)),typeof s=="function"){try{window.removeEventListener("resize",this.onresize)}catch(h){}this.onresize=s,window.addEventListener("resize",this.onresize)}}else if(e==="ondelete"){let s=i;typeof s=="string"&&(s=b(s)),typeof s=="function"&&(this.ondelete=()=>{window.removeEventListener("resize",this.onresize),this.state.unsubscribeTrigger("props"),s()})}else if(e==="oncreate"){let s=i;typeof s=="string"&&(s=b(s)),typeof s=="function"&&(this.oncreate=s)}else if(e==="props"){let s=i;typeof s=="string"&&(s=JSON.parse(s)),Object.assign(this.props,s),this.state.setState({props:this.props})}else if(e==="template"){let s=i;this.template=options.template,typeof s=="function"?this.templateString=this.template(this.props):this.templateString=s,this.render(this.props);let h=new CustomEvent("created",{detail:{props:this.props}});this.dispatchEvent(h)}else{let s=i;e.includes("eval_")?(e=e.split("_"),e.shift(),e=e.join(),s=b(i)):typeof i=="string"&&(s=JSON.parse(i)),this[e]=s,this.props[e]=s}}connectedCallback(){let e=this.getAttribute("props");typeof e=="string"&&(e=JSON.parse(e)),Object.assign(this.props,e),this.state.setState({props:this.props}),Array.from(this.attributes).forEach(u=>{let r=u.name;if(!this[r]){let o=u.value;r.includes("eval_")?(r=r.split("_"),r.shift(),r=r.join(),o=b(u.value)):typeof u.value=="string"&&(o=JSON.parse(u.value)),Object.defineProperties(this,u,{value:o,writable:!0,get(){return this[r]},set(l){this.setAttribute(r,l)}}),this[r]=o,this.props[r]=o,this.obsAttributes.push(r)}});let t=new CustomEvent("resized",{detail:{props:this.props}}),i=new CustomEvent("changed",{detail:{props:this.props}}),s=new CustomEvent("deleted",{detail:{props:this.props}}),h=new CustomEvent("created",{detail:{props:this.props}});if(this.render(this.props),this.dispatchEvent(h),this.state.subscribeTrigger("props",()=>{this.dispatchEvent(i)}),typeof this.onresize=="function"&&window.addEventListener("resize",()=>{this.onresize(),this.dispatchEvent(t)}),typeof this.ondelete=="function"){let u=this.ondelete;this.ondelete=()=>{window.removeEventListener("resize",this.onresize),this.state.unsubscribeTrigger("props"),u(),this.dispatchEvent(s)}}typeof this.onchanged=="function"&&(this.state.data.props=this.props,this.state.subscribeTrigger("props",this.onchanged))}get props(){return this.props}set props(e={}){this.setAttribute("props",e)}get template(){return this.template}set template(e){this.setAttribute("template",e)}get render(){return this.render}get delete(){return this.delete}get state(){return this.state}get onchanged(){return this.onchanged}set onchanged(e){this.setAttribute("onchanged",e)}get onresize(){return this.props}set onresize(e){this.setAttribute("onresize",e)}get ondelete(){return this.props}set ondelete(e){this.setAttribute("ondelete",e)}get oncreate(){return this.oncreate}set oncreate(e){this.setAttribute("oncreated",e)}};function d(n,e,t=null){t?e?window.customElements.define(e,n,{extends:t}):window.customElements.define(n.name.toLowerCase()+"-",n,{extends:t}):e?window.customElements.define(e,n):window.customElements.define(n.name.toLowerCase()+"-",n)}function $(n=""){return n+Math.floor(Math.random()*1e15)}function b(method){let getFunctionBody=n=>n.replace(/^\W*(function[^{]+\{([\s\S]*)\}|[^=]+=>[^{]*\{([\s\S]*)\}|[^=]+=>(.+))/i,"$2$3$4"),getFunctionHead=n=>{let e=n.indexOf(")");return n.slice(0,n.indexOf("{",e)+1)},newFuncHead=getFunctionHead(method),newFuncBody=getFunctionBody(method),newFunc;try{if(newFuncHead.includes("function ")){let n=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(n,newFuncBody)}else if(newFuncHead.substring(0,6)===newFuncBody.substring(0,6)){let n=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(n,newFuncBody.substring(newFuncBody.indexOf("{")+1,newFuncBody.length-1))}else try{newFunc=eval(newFuncHead+newFuncBody+"}")}catch(err){newFunc=eval(method)}}catch(n){}return newFunc}var y=class{constructor(){this.nodes=new Map,this.nNodes=0,this.state={pushToState:{},data:{},triggers:{},setState(e){if(Object.assign(this.pushToState,e),Object.keys(this.triggers).length>0)for(let t of Object.getOwnPropertyNames(this.triggers))this.pushToState[t]&&(this.data[t]=this.pushToState[t],delete this.pushToState[t],this.triggers[t].forEach(i=>{i.onchange(this.data[t])}));return this.pushToState},subscribeTrigger(e,t=i=>{}){if(e){this.triggers[e]||(this.triggers[e]=[]);let i=this.triggers[e].length;return this.triggers[e].push({idx:i,onchange:t}),this.triggers[e].length-1}else return},unsubscribeTrigger(e,t){let i,s=this.triggers[e];if(s)if(!t)delete this.triggers[e];else return s.find(u=>{if(u.idx===t)return!0})&&s.splice(i,1),!0},subscribeTriggerOnce(e=void 0,t=i=>{}){let i,s=h=>{t(h),this.unsubscribeTrigger(e,i)};i=this.subscribeTrigger(e,s)}}}convertChildrenToNodes(e){e.convertChildrenToNodes(e)}addNode(e={}){return new m(e,void 0,this)}getNode(e){return this.nodes.get(e)}run(e,t,i){if(typeof e=="string"&&(e=this.nodes.get(e)),e)return e.runNode(e,t,i)}removeTree(e){if(typeof e=="string"&&(e=this.nodes.get(e)),e){let t=function(i){i.children&&(Array.isArray(i.children)?i.children.forEach(s=>{this.nodes.delete(s.tag),t(s)}):typeof i.children=="object"&&(this.nodes.delete(i.tag),t(i)))};this.nodes.delete(e.tag),t(e)}}removeNode(e){typeof e=="string"&&(e=this.nodes.get(e)),e&&this.nodes.delete(e.tag)}appendNode(e={},t){t.addChildren(e)}callParent(s,h){return c(this,arguments,function*(e,t,i=e){if(e==null?void 0:e.parent)return yield e.callParent(t,e.children,i)})}callChildren(h,u){return c(this,arguments,function*(e,t,i=e,s){if(e==null?void 0:e.children)return yield e.callChildren(t,i,s)})}subscribe(e,t=i=>{}){return this.state.subscribeTrigger(e,t)}unsubscribe(e,t){this.state.unsubscribeTrigger(e,t)}},m=class{constructor(e={},t,i={}){a(this,"parent");a(this,"children");a(this,"graph");!e.tag&&i?e.tag=`node${i.nNodes}`:e.tag||(e.tag=`node${Math.floor(Math.random()*1e10)}`),Object.assign(this,e),this.parent=t,this.graph=i,i&&(i.nNodes++,i.nodes.set(e.tag,this)),this.children&&this.convertChildrenToNodes(this)}operator(e,t=this,i){return e}runOp(s){return c(this,arguments,function*(e,t=this,i){let h=yield this.operator(e,t,i);return this.tag&&this.graph&&this.graph.state.setState({[this.tag]:h}),h})}runNode(e=this,t,i){if(typeof e=="string"){if(!this.graph)return;e=this.graph.nodes.get(e)}return new Promise(s=>c(this,null,function*(){if(e){let h=(r,o,l=0)=>new Promise(g=>c(this,null,function*(){l++;let f=yield r.runOp(o,r,i);if(typeof r.repeat=="number"){for(;l<r.repeat;){if(r.delay){setTimeout(()=>c(this,null,function*(){g(yield h(r,o,l))}),r.delay);break}else if(r.frame&&requestAnimationFrame){requestAnimationFrame(()=>c(this,null,function*(){g(yield h(r,o,l))}));break}else f=yield r.runOp(o,r,i);l++}if(l===r.repeat){g(f);return}}else if(typeof r.recursive=="number"){for(;l<r.recursive;){if(r.delay){setTimeout(()=>c(this,null,function*(){g(yield h(r,f,l))}),r.delay);break}else if(r.frame&&requestAnimationFrame){requestAnimationFrame(()=>c(this,null,function*(){g(yield h(r,f,l))}));break}else f=yield r.runOp(f,r,i);l++}if(l===r.recursive){g(f);return}}else{g(f);return}})),u=()=>c(this,null,function*(){let r=yield h(e,t);if(e.backward&&e.parent&&(yield this.runNode(e.parent,r,e)),e.children&&e.forward)if(Array.isArray(e.children))for(let o=0;o<e.children.length;o++)yield this.runNode(e.children[o],r,e);else yield this.runNode(e.children,r,e);return r});e.delay?setTimeout(()=>c(this,null,function*(){s(yield u())}),e.delay):e.frame&&requestAnimationFrame?requestAnimationFrame(()=>c(this,null,function*(){s(yield u())})):s(yield u())}else s(void 0)}))}setOperator(e=function(i,s=this,h){return i}){this.operator=e}setParent(e){this.parent=e}addChildren(e){Array.isArray(this.children)||(this.children=[this.children]),Array.isArray(e)?this.children.push(...e):this.children.push(e)}convertChildrenToNodes(e=this){if(Array.isArray(e.children))for(let t=0;t<e.children.length;t++)e.children[t].constructor.name!==this.constructor.name&&(e.children[t]=new m(nn,e,this.graph),this.convertChildrenToNodes(e.children[t]));else if(typeof e.children=="object"){if(e.children.constructor.name===this.constructor.name)return;e.children=new m(e.children,e,this.graph),this.convertChildrenToNodes(e.children)}else typeof e.children=="string"&&(e.children=this.graph.getNode(e.children));return e.children}callParent(i){return c(this,arguments,function*(e,t=this){var s;if(typeof((s=this.parent)==null?void 0:s.operator)=="function")return yield this.parent.runOp(e,this.parent,t)})}callChildren(s){return c(this,arguments,function*(e,t=this,i){var u,r;let h;if(Array.isArray(this.children))if(i)h=yield(u=this.children[i])==null?void 0:u.runOp(e,this.children[i],t);else{h=[];for(let o=0;o<this.children.length;o++)h.push(yield(r=this.children[i])==null?void 0:r.runOp(e,this.children[i],t))}else this.children&&(h=yield this.children.runOp(e,this.children,t));return h})}setProps(e={}){Object.assign(this,e)}};var z=S(),q=class extends p{constructor(){super(...arguments);a(this,"props",{tag:void 0,input:void 0,operator:(e,t,i)=>(console.log(e),e),forward:!0,backward:!1,children:void 0,delay:!1,repeat:!1,recursive:!1,graph:void 0,node:void 0});a(this,"template",z);a(this,"oncreate",e=>{this.setupNode(e),e.input&&e.node.runNode(e.node,e.input,void 0)})}setupNode(e){if(!e.graph){let t=this.parentNode;for(t.constructor.name==="NodeDiv"&&(e.parent=t.node);(t==null?void 0:t.constructor.name)!=="AcyclicGraph";){if(t.constructor.name==="HTMLBodyElement"||t.constructor.name==="HTMLHeadElement"||t.constructor.name==="HTMLHtmlElement"||t.constructor.name==="HTMLDocument"){console.error("No AcyclicGraph Found, error");break}t=t.parentNode}t.constructor.name==="AcyclicGraph"&&(e.graph=t.props.graph)}this.id&&!e.tag&&(e.tag=this.id),e.node=new m(e,parent.node,e.graph),e.tag=e.node.tag,this.id||(this.id=e.tag)}};d(q,"graph-node");var M=A(),v=class extends p{constructor(){super(...arguments);a(this,"props",{graph:new y,nodes:[]});a(this,"template",M);a(this,"graphnode");a(this,"oncreate",e=>{let t=this.querySelectorAll("graph-node");(t==null?void 0:t.length)>0&&t.forEach(s=>{e.nodes.push(s.props.node)});let i=this.querySelectorAll("acyclic-graph > graph-node");this.querySelector("button").onclick=()=>{i.forEach(s=>{s.props.node.runNode(s.props.node)})}})}};d(v,"acyclic-graph");var P=T(),E=class extends p{constructor(){super(...arguments);a(this,"props",{operation:e=>e});a(this,"template",P);a(this,"oncreate",e=>{})}};d(E,"snode-");var ae=T();d(Graph,"sequencer-");var D=O(),x=class extends p{constructor(){super(...arguments);a(this,"props",{});a(this,"template",D);a(this,"oncreate",e=>{let t=this.querySelector("button"),i=this.querySelector("div");t&&(t.onclick=s=>{i.innerHTML="Clicked!"})})}};d(x,"custom-");var F=document.createElement("custom-");console.log("custom element:",F,F.__proto__);})();
//# sourceMappingURL=app.js.map
